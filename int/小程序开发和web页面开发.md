# 小程序出现的原因
webview通过调用js-sdk调用一些普通网页不能完成的系统功能，虽然js-sdk虽然解决了移动网页能力不足的问题，但其并没有解决使用移动网页遇到的不良体验问题。因为**受限于设备性能和网络速度出现的白屏问题**，于是出现了增强版本的JS-SDK，其中有一个重要功能，称之为“**微信web资源离线存储**”。但是 离线存储 能够解决了一些问题，但是对于**一些复杂的页面依然会有白屏的问题，例如页面加载了大量的 CSS 或者是 JavaScript 文件，这些文件的执行时间占用了大量的 UI 线程，这种时候，即使通过离线存储快速的加载资源，但是依旧会有页面的白屏现象**。除了白屏，影响 Web 体验的问题还有缺少操作的反馈，主要表现在两个方面：页面切换的生硬和点击的迟滞感。**对于一些有经验的 Web开发者而言，会使用一些 SPA 的框架，来模拟客户端原生的页面切换过渡。**通常的方式是在一个 WebView 中去模拟多个页面，通过 CSS 处理，加之精细化的脚本代码做到点击反馈和页面切换，获得较好的体验。然而并不是所有的开发者都有足够的时间和精力来使得页面的体验变得出色。

# 小程序开发和web网页开发的区别

第一个区别就是单线程和双线程的区别

* 网页开发渲染线程和脚本线程是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应
* 小程序中，小程序的渲染层和逻辑层分别由 2 个线程管理：视图层的界面使用了 WebView 进行渲染，逻辑层采用 JsCore 线程运行 JS脚本，这样可以提高效率。小程序的逻辑层和渲染层是分开的，逻辑层运行在 JSCore 中，并没有一个完整浏览器对象，因而缺少相关的DOM API和BOM API。

第二个区别 网页没有操作系统的api 但是小程序有操作系统的api和系统原生控件

* 小程序定义了很多api和原生进行通信，提高性能。
* 小程序里面可以嵌入了部分原生控件提升性能。

第三个区别

* PC 端需要面对 IE、Chrome、QQ浏览器等，在移动端需要面对Safari、Chrome以及 iOS、Android 系统中的各式 WebView 。
* 小程序开发过程中需要面对的是两大操作系统 iOS 和 Android 的微信客户端的不同的代码运行环境


# 小程序的双线程机制

小程序分为视图层和逻辑层，视图层的相关任务全都在WebView里执行。一个小程序存在多个界面，所以视图层存在多个WebView线程。而逻辑层采用JsCore线程运行JS脚本。他们之间通过系统层的WeixinJsBridge进行通信，也就是逻辑层把数据变化通知到视图层，触发视图层页面更新，视图层把触发的事件通知到逻辑层进行业务处理。在渲染层把 WXML 转化成对应的 JS 对象。在逻辑层发生数据变更的时候，通过宿主环境提供的 setData 方法把数据从逻辑层传递到 Native，再转发到渲染层。经过对比前后差异，把差异应用在原来的 DOM 树上，更新界面。

[图片链接](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65688db20c4e415aac7bc63e1c0308fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

逻辑层的JS代码全部载入到一个Webview里面，称之为AppService，整个小程序仅仅有一个，而且整个生命周期常驻内存；而全部的视图（wxml和wxss）都是单独的Webview来承载，称之为AppView。我们在渲染层的请求并不会直接到了逻辑层，而是会先到了系统层。在系统层先进行操作处理一部分功能再将数据传递给逻辑层，逻辑层也一样。 所以不能频繁进行setdata请求绑定交互。如果当前数据并不会在页面中进行显示，数据也不应该定义在data中，否则每次在进行数据绑定时，这些数据也会进行一次从数据层到逻辑层的传递，占用了系统层的资源。

[原文链接](https://juejin.cn/post/7035089295199174664)
[原文链接]（https://developers.weixin.qq.com/community/develop/article/doc/0000461093c4d8782ff7cf7d95b413）